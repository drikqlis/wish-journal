[pytest]
# Pytest configuration for wish-journal

# Test discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Output options
addopts =
    --strict-markers
    --tb=short
    --disable-warnings

# Filter specific warnings
filterwarnings =
    # Ignore pexpect forkpty deprecation warnings in Python 3.13+
    #
    # Background: pexpect uses os.forkpty() for PTY allocation, which Python 3.13
    # now warns about in multi-threaded contexts (test suite runs tests in threads).
    #
    # Why this is safe to ignore:
    # 1. Our script_runner creates new processes via pexpect, not threads
    # 2. Each script execution happens in an isolated subprocess
    # 3. The warning is about potential deadlocks in the child process,
    #    but our scripts are simple Python scripts without threading
    # 4. This is a known limitation of pexpect with Python 3.13
    # 5. The pexpect maintainers are aware and working on alternatives
    #
    # Alternative solutions considered:
    # - Using subprocess.Popen directly would lose interactive TTY support
    # - ptyprocess library has the same limitation
    # - pytest-xprocess doesn't support interactive I/O
    #
    # The functionality works correctly despite the warning.
    ignore:This process.*is multi-threaded.*use of forkpty.*may lead to deadlocks:DeprecationWarning:pty

# Coverage options
[coverage:run]
source = app
omit =
    */tests/*
    */venv/*
    */__pycache__/*

[coverage:report]
precision = 2
show_missing = True
skip_covered = False
